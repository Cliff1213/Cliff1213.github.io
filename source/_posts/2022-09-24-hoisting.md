---
title: JavaScript 觀念 - 提升
date: 2022-09-24
tags:
 - hoisting
categories: JavaScript
banner:
  url: /images/banner/banner_js.jpg
  width: 1280
  height: 720
---

Hoisting 觀念筆記。

<!--more-->

------

「提升（Hoisting）」是 JavaScript 特有的一種現象，它的意思是當一個變數或函式在被宣告之前就可以被使用，並且不會出現錯誤。

範例：

```js
console.log(x);
// Uncaught ReferenceError: x is not defined
```

以上範例只針對 `x` 取值，但是在取值之前並沒有宣告一個名為 `x` 的變數，因此會找不到該變數而回報錯誤。而正常的情況如下：

```js
var x;
console.log(x);
// undefined
```

這樣就是一個正常的流程，程式碼會從第一行開始由上往下執行，所以在使用變數之前需要先宣告變數，以確保這個變數是存在的，否則就會回報錯誤。

接著嘗試把第 1、2 行位置進行對調，如下：

```js
console.log(x);
var x;
// undefined
```

按照前面的說法，上述程式碼應該會回報錯誤，但是得到的結果卻是 `undefined`，而這就是提升所造成的現象，感覺就像是 `var x` 這段程式碼被提升到所有程式碼的最上方。

大多數的程式語言中，變數在被使用之前是需要先宣告的，但是 JavaScript 可以在變數宣告之前就使用該變數，所以一開始才會說提升是 JavaScript 特有的現象，不過關於提升還有一些地方需要特別留意，就是會被提升的只有**宣告的行為**，值的指派並不會被提升，如下：

```js
var x = 7; // 宣告變數並指派值
console.log(x);
// 7
```

以上範例跟前面的相同，只是多了一個指派數值的動作，而最後也印出預期的結果，這個時候如果再將 1、2 行位置進行對調，印出的結果會是 `7` 嗎？

結果如下：

```js
console.log(x);
var x = 7;
// undefined
```

答案是 `undefined`，照理來說宣告的變數會被提升，可是得到的結果卻不是 `7`，原因其實很簡單，前面有提到會被提升的只有宣告的動作，而範例中宣告的動作指的是 `var x`，後方的 `= 7` 屬於值的指派，並不會跟著宣告一起被提升，但是結果為甚麼會是 `undefined`？這是因為 JavaScript 在開始執行你撰寫的程式碼之前，會先把所有宣告的變數、函式都預留一個記憶體空間（全域記憶體），但不會馬上指派值給變數，這個預留記憶體空間的動作就是提升，而到這邊為止屬於「創造階段」，在這個階段結束之後，變數才會被賦值；而 `undefined` 就是變數在透過 `var` 宣告時，預設給予的初始值。

可以將上面的程式碼拆解成以下寫法：

```js
console.log(x);
var x; // 宣告變數（會被提升）
x = 7; // 指派值
// undefined
```

到目前為止已經知道會被提升的只有宣告的動作，但是除了變數之外，函式也能夠透過宣告的方式建立，因此函式也會被提升。

範例：

```js
fn();
function fn() {
  console.log('hello');
}
// hello
```

嘗試在函式被宣告之前呼叫，也可以順利執行且不會回報錯誤，不過需要注意的是，範例中的函式是透過函式宣告的方式也就是具名函式所建立的，而這也呼應了前面所提到的「會被提升的只有宣告的行為」，因此在呼叫函式 `fn` 時才不會出錯。

那匿名函式就不會被提升嗎？答案是會，我們嘗試將範例改成以匿名函式的方式建立，如下：

```js
fn();
var fn = function() {
  console.log('hello');
}
// Uncaught TypeError: fn is not a function
```

結果出現錯誤了，不過是不是有似曾相似的感覺？其實就跟前面的變數概念是一樣的，這裡的程式碼確實有被提升，但是被提升的只有變數的宣告 `var fn`，因此在創造階段有預留記憶體空間的只有 `fn` 這個變數，此時還沒開始指派函式資料，所以 `fn` 給定的值還是 `undefined`，而 `undefined` 並非函式所以無法被呼叫。

雖然無法呼叫，但是可以透過取值的方式來驗證上述說法，如下：

```js
console.log(fn);
var fn = function() {
  console.log('hello');
}
// undefined
```

```js
console.log(fn);
var fn;
fn = function() {
  console.log('hello');
}
// undefined
```

兩種結果是一樣的。

最後做個總結，JavaScript 中的「提升（Hoisting）」指的是宣告變數的提升，而值的賦予並不會提升；此外，提升並不會移動變數的位置，只是感覺像是整段程式碼被移動到最上方。